<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>D3 Demo: GeoJSON</title>
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.js"></script>
		<style type="text/css">
			/* No style rules here yet */		
			
			#container {
    border: medium solid;
    position: relative;
    width: 1400px;
}
#map {
    border: medium solid;
    position: relative;
    width: 1000px;
}
#text {
    border: medium solid;
    bottom: 0;
    height: 800px;
    position: absolute;
    right: 0;
    width: 500px;
}
span {
    bottom: 0;
    font-family: helvetica;
    font-size: 3em;
    position: absolute;
    text-align: left;
    transform: scale(1, 1.1);
	-webkit-transform:scale(1,1.5); /* Safari and Chrome */
-moz-transform:scale(1,1.5); /* Firefox */
-ms-transform:scale(1,1.5); /* IE 9+ */
-o-transform:scale(1,1.5); /* Opera */;
}

#ninety, #ten{
	font-size: 3em;
	}
		</style>
	</head>
	<body>
	<div id="container">
	<div id="map">
		</div>
		<div id="ten">2010</div><div id="ninety">1990</div><div id="text"><span>RRRMinnesota: Ten Largest Cities by Population</span></div>
				<script type="text/javascript">

			//Width and height
			var w = 1000;
			var h = 800;
			var svg = d3.select("#map")
						.append("svg")
						.attr("width", w)
						.attr("height", h);
			//define projection
			var mnProjection = d3.geo.albers().rotate([94, 0]).center([0, 46]).parallels([39.5, 55.5]);
			//var mnProjection = d3.geo.transverseMercator().rotate([93, -45]).center([0, 0]);
			//mnProjection.rotate([94, 7.5, 0]).parallels([39.5, 55.5]);
			//mnProjection.center([-100, 0]);
			var thePaths = d3.geo.path().projection(mnProjection);
			
			d3.select("#ninety").on("click", function(){
				d3.selectAll("circle").data([]).exit().transition().duration(1000).attr("r", 0).remove();

				d3.csv("MN_1990_Places_Pop_Top_10.csv", function(data){
					svg.selectAll("circle")
					.data(data)
					.transition()
					.duration(1000)
					
						   .attr("r", function(d) {
								return Math.sqrt(parseInt(d.pop) * 0.00104);
						   })
						   .style("stroke", "white")
						   .style("stroke-width", "2px")
						   .style("fill", "orange")
						   .style("opacity", 0.65);
					});
			});
			
			d3.select("#ten").on("click", function(){
				d3.csv("MN_2010_Places_Pop_Top_10.csv", function(data){
					svg.selectAll("circle")
					.data(data)
					.enter()
					.append
					.transition()
						   .attr("r", function(d) {
								return Math.sqrt(parseInt(d.pop) * 0.00504);
						   })
						   .style("stroke", "white")
						   .style("stroke-width", "2px")
						   .style("fill", "steelblue")
						   .style("opacity", 0.65);
					});
			});
			d3.json("ne_10m_admin_1_states_provinces_lakes_geojson.json", function(json) {
						var mn = json.features.filter(function(d) {
								return d.properties.NAME_1 ==  "Minnesota";
								});
						mnProjection.scale(1).translate([0,0]);
						//mnProjection.rotate([0, 1, 0]);
						var b = thePaths.bounds(mn[0]),
							s = .95 / Math.max((b[1][0] - b[0][0]) / w, (b[1][1] - b[0][1]) / h),
							t = [(w - s * (b[1][0] + b[0][0])) / 2, (h - s * (b[1][1] + b[0][1])) / 2];
						
						mnProjection.scale(s).translate(t);
						
						svg.selectAll("path")
					   .data(mn)
					   .enter()
					   .append("path")
					   .attr("d", thePaths)
					   .style("fill", "green")
					   .style("opacity", 0.25)
					   .style("stroke", "blue");
					
								   
					d3.csv("MN_2010_Places_Pop_Top_10.csv", function(data){
					var key = function (d){
						return d.name;
						};
					
					var bob = svg.selectAll("circle").data(data, key)
					   .enter()
					   .append("circle")
					   .attr("cx", function(d) {
							   return mnProjection([d.lon, d.lat])[0];
						   })
						   .attr("cy", function(d) {
							   return mnProjection([d.lon, d.lat])[1];
						   })
						.transition()
						.duration(1000)
						   .attr("r", function(d) {
								return Math.sqrt(parseInt(d.pop) * 0.00104);
						   })
						   .style("stroke", "white")
						   .style("stroke-width", "2px")
						   .style("fill", "steelblue")
						   .style("opacity", 0.65);
						console.log(bob[0][0].__data__.pop);
						});
						
				
			});
			//load csv data
					
			
		</script>
	</body>
</html>